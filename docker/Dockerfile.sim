FROM ros:jazzy

ENV DEBIAN_FRONTEND=noninteractive
ENV LANG=C.UTF-8
ENV LC_ALL=C.UTF-8

# ----------------------------------------
# 1. 기본 도구
# ----------------------------------------
RUN apt-get update && apt-get install -y \
    curl \
    gnupg \
    lsb-release \
    python3-colcon-common-extensions \
    python3-pytest \
    && rm -rf /var/lib/apt/lists/*

# ----------------------------------------
# 2. Gazebo Harmonic repo 등록
# ----------------------------------------
RUN curl -sSL https://packages.osrfoundation.org/gazebo.gpg \
    | gpg --dearmor -o /usr/share/keyrings/gazebo-archive-keyring.gpg

RUN echo "deb [arch=amd64 signed-by=/usr/share/keyrings/gazebo-archive-keyring.gpg] \
    http://packages.osrfoundation.org/gazebo/ubuntu-stable \
    $(lsb_release -cs) main" \
    > /etc/apt/sources.list.d/gazebo-stable.list

# ----------------------------------------
# 3. Gazebo Harmonic + ROS-GZ
# ----------------------------------------
RUN apt-get update && apt-get install -y \
    gz-harmonic \
    ros-jazzy-ros-gz \
    && rm -rf /var/lib/apt/lists/*

# ----------------------------------------
# 4. Workspace
# ----------------------------------------
WORKDIR /ros2_ws
COPY . .

RUN /bin/bash -c "\
    source /opt/ros/jazzy/setup.bash && \
    colcon build \
"

CMD ["bash"]
